<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Qmovi • Almoxarifado</title>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="css/almoxarifado.css" />
</head>
<body>
  <header class="topbar">
    <a class="brand" href="dashboard.html" aria-label="Início Qmovi">
      <img class="logo" src="img/qLaranjaMoviAzul.png" alt="Qmovi" />
    </a>

    <!-- Menu do usuário -->
    <div class="user-menu">
      <button id="avatarBtn" class="avatar-btn" aria-haspopup="menu" aria-controls="userMenu" aria-expanded="false">
        <span class="avatar-circle" aria-hidden="true">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M20 21a8 8 0 0 0-16 0" />
            <circle cx="12" cy="7" r="4" />
          </svg>
        </span>
        <span class="sr-only">Abrir menu do usuário</span>
      </button>

      <div id="userMenu" class="menu" role="menu" aria-labelledby="avatarBtn">
        <button class="menu-item" role="menuitem" data-action="profile">
          <span class="ico ico-user" aria-hidden="true">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M20 21a8 8 0 0 0-16 0" />
              <circle cx="12" cy="7" r="4" />
            </svg>
          </span>
          <span>Editar perfil</span>
        </button>

        <div class="menu-sep" role="separator"></div>

        <button class="menu-item danger" role="menuitem" data-action="logout">
          <span class="ico ico-exit" aria-hidden="true">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4" />
              <polyline points="16 17 21 12 16 7" />
              <line x1="21" y1="12" x2="9" y2="12" />
            </svg>
          </span>
          <span>Sair</span>
        </button>
      </div>
    </div>
  </header>

  <main class="wrap">
    <!-- Breadcrumb minimalista -->
    <nav class="crumbs" aria-label="Caminho">
      <a href="dashboard.html" aria-current="page">Home</a>
      <span aria-hidden="true">›</span>
      <strong>Almoxarifado</strong>
    </nav>

    <!-- Toolbar -->
    <section class="toolbar" aria-label="Ferramentas de listagem">
      <div class="filters">
        <label class="field" style="flex:1;min-width:260px">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="11" cy="11" r="7" />
            <line x1="21" y1="21" x2="16.65" y2="16.65" />
          </svg>
          <input id="q" placeholder="Buscar por nome, ID..." autocomplete="off" />
        </label>
      </div>
      <div class="actions">
        <button class="btn" id="btnNew" type="button">+ Novo Produto</button>
        <button class="btn secondary" id="btnBaixa" type="button">Baixa de Estoque</button>
        <button class="btn secondary" id="btnExportCSV" type="button">Exportar CSV</button>
        <button class="btn secondary" id="btnPrint" type="button">Imprimir / PDF</button>
      </div>
    </section>

    <!-- Tabela -->
    <section class="card">
      <header class="card-head">
        <h2>Produtos</h2>
        <small id="listCount">0 itens</small>
      </header>
      <div class="table-wrap">
        <table class="table" id="grid" aria-label="Tabela de produtos">
          <thead>
            <tr>
              <th>ID</th>
              <th>Nome</th>
              <th>Unid.</th>
              <th>Estoque</th>
              <th>Local</th>
              <th>Mín.</th>
              <th style="width:180px">Ações</th>
            </tr>
          </thead>
          <tbody id="gridBody"><!-- dados via JS --></tbody>
        </table>
      </div>
      <footer class="card-foot">
        <!-- paginação -->
        <nav id="pager" class="pager" aria-label="Paginação"></nav>
      </footer>
    </section>
  </main>

  <!-- Footer idêntico ao da dashboard -->
  <footer class="footer">
    © <span id="year"></span> Qmovi — Todos os direitos reservados.
  </footer>

  <!-- Modal: Novo Produto -->
  <dialog id="modalProduto" class="modal" aria-labelledby="produtoTitulo">
    <form id="formProduto" method="dialog">
      <header><h3 id="produtoTitulo">Novo Produto</h3></header>
      <div class="grid">
        <input type="hidden" id="id" />
        <label class="field"><span>Nome</span><input id="name" required maxlength="120" /></label>

        <!-- Setor (dropdown estilizado) -->
        <label class="field">
          <span>Setor</span>
          <select id="sector" required>
            <option value="" disabled selected>Selecione o setor…</option>
            <option value="Almoxarifado">Almoxarifado</option>
            <option value="PCP">PCP</option>
            <option value="Embalagem">Embalagem</option>
            <option value="Expedição">Expedição</option>
            <option value="Carregamento">Carregamento</option>
            <option value="Administracao">Administração</option>
            <option value="Manutenção">Manutenção</option>
            <option value="Furadeira">Furadeira</option>
            <option value="Usinagem">Usinagem</option>
            <option value="Corte">Corte</option>
            <option value="Borda">Borda</option>
            <option value="Pintura">Pintura</option>
            <option value="Outros">Outros</option>
          </select>
        </label>

        <label class="field"><span>Categoria</span><input id="category" maxlength="60" /></label>

        <!-- Unidade como texto -->
        <label class="field"><span>Unidade</span><input id="unit" maxlength="10" placeholder="ex.: un, cx, kg" /></label>

        <label class="field"><span>Estoque</span><input id="stock" type="number" min="0" step="1" /></label>
        <label class="field"><span>Local</span><input id="location" maxlength="40" /></label>
        <label class="field"><span>Mínimo</span><input id="min" type="number" min="0" step="1" /></label>

        <!-- Nº Nota Fiscal -->
        <label class="field"><span>Nº Nota Fiscal</span><input id="nfeNumber" maxlength="40" placeholder="Ex.: 12345-1" /></label>

        <!-- Conferente responsável -->
        <label class="field"><span>Conferente</span><input id="checker" maxlength="60" placeholder="Nome do conferente" /></label>
      </div>
      <footer>
        <button class="btn" value="confirm" type="submit">Salvar</button>
        <button class="btn secondary" data-cancel type="button">Cancelar</button>
      </footer>
    </form>
  </dialog>

  <!-- Modal: Baixa de Estoque (por ID) -->
  <dialog id="modalBaixa" class="modal" aria-labelledby="baixaTitulo">
    <form id="formBaixa" method="dialog">
      <header><h3 id="baixaTitulo">Baixa de Estoque</h3></header>
      <div class="grid">
        <label class="field">
          <span>ID do Produto</span>
          <input id="produtoId" type="number" min="1" step="1" required placeholder="Ex.: 101" />
        </label>

        <label class="field">
          <span>Quantidade a Dar Baixa</span>
          <input id="quantidadeBaixa" type="number" min="1" step="1" required placeholder="Ex.: 3" />
        </label>

        <!-- É para o setor subsequente? -->
        <label class="field">
          <span>Para setor responsável?</span>
          <select id="subsequente" required>
            <option value="" disabled selected>Selecione…</option>
            <option value="SIM">Sim</option>
            <option value="NAO">Não</option>
          </select>
        </label>

        <!-- Só aparece se subsequente=NAO -->
        <label class="field is-hidden" id="wrapAutGestor">
          <span>Autorizado?</span>
          <select id="autGestor">
            <option value="" disabled selected>Selecione…</option>
            <option value="SIM">Sim</option>
            <option value="NAO">Não</option>
          </select>
        </label>

        <!-- Conferente responsável -->
        <label class="field">
          <span>Conferente</span>
          <input id="checkerBaixa" maxlength="60" placeholder="Nome do conferente" />
        </label>
      </div>
      <footer>
        <button class="btn" type="submit">Confirmar Baixa</button>
        <button class="btn secondary" data-cancel type="button">Cancelar</button>
      </footer>
    </form>
  </dialog>

  <script src="js/almoxarifado.js" defer></script>
</body>
</html>
